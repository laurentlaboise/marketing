<%- include('../../partials/head', { title, bodyClass: 'dashboard-layout' }) %>
<%- include('../../partials/sidebar', { currentPage, user }) %>

<main class="main-content">
  <%- include('../../partials/header', { user, messages }) %>

  <div class="page-content">
    <div class="page-header">
      <div>
        <h1 class="page-title">Campaigns</h1>
        <p class="page-subtitle">Organize posts into strategic campaigns</p>
      </div>
      <div class="page-actions">
        <a href="/social/campaigns/new" class="btn btn-primary"><i class="fas fa-plus"></i> New Campaign</a>
      </div>
    </div>

    <!-- Filters -->
    <div class="card" style="margin-bottom: 20px;">
      <div class="card-body" style="padding: 16px 24px;">
        <form action="/social/campaigns" method="GET" style="display: flex; gap: 12px; align-items: center;">
          <select name="status" class="form-input" style="width: 160px;">
            <option value="">All Status</option>
            <option value="draft" <%= filter.status === 'draft' ? 'selected' : '' %>>Draft</option>
            <option value="active" <%= filter.status === 'active' ? 'selected' : '' %>>Active</option>
            <option value="paused" <%= filter.status === 'paused' ? 'selected' : '' %>>Paused</option>
            <option value="completed" <%= filter.status === 'completed' ? 'selected' : '' %>>Completed</option>
          </select>
          <button type="submit" class="btn btn-secondary btn-sm"><i class="fas fa-filter"></i> Filter</button>
        </form>
      </div>
    </div>

    <% if (campaigns.length > 0) { %>
    <div class="campaign-grid">
      <% campaigns.forEach(campaign => { %>
      <div class="campaign-card">
        <div class="campaign-card-header" style="border-left: 4px solid <%= campaign.color || '#667eea' %>;">
          <div style="flex: 1;">
            <h3 class="campaign-card-title"><%= campaign.name %></h3>
            <% if (campaign.objective) { %>
            <span class="campaign-objective"><i class="fas fa-bullseye"></i> <%= campaign.objective %></span>
            <% } %>
          </div>
          <span class="status-badge <%= campaign.status %>"><%= campaign.status %></span>
        </div>
        <div class="campaign-card-body">
          <% if (campaign.description) { %>
          <p class="campaign-desc"><%= campaign.description.substring(0, 120) %><%= campaign.description.length > 120 ? '...' : '' %></p>
          <% } %>

          <div class="campaign-meta">
            <div class="campaign-meta-item">
              <i class="fas fa-pen"></i>
              <span><%= campaign.post_count || 0 %> posts</span>
            </div>
            <% if (campaign.start_date) { %>
            <div class="campaign-meta-item">
              <i class="fas fa-calendar-alt"></i>
              <span><%= new Date(campaign.start_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) %><%= campaign.end_date ? ' - ' + new Date(campaign.end_date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : '' %></span>
            </div>
            <% } %>
            <% if (campaign.budget) { %>
            <div class="campaign-meta-item">
              <i class="fas fa-dollar-sign"></i>
              <span><%= campaign.budget_currency || 'USD' %> <%= parseFloat(campaign.budget).toLocaleString() %></span>
            </div>
            <% } %>
          </div>

          <% if (campaign.labels && campaign.labels.length > 0) { %>
          <div class="campaign-labels">
            <% campaign.labels.forEach(label => { %>
            <span class="campaign-label"><%= label %></span>
            <% }); %>
          </div>
          <% } %>
        </div>
        <div class="campaign-card-footer">
          <a href="/social/posts/new?campaign=<%= campaign.id %>" class="btn btn-sm btn-secondary"><i class="fas fa-plus"></i> Add Post</a>
          <a href="/social/campaigns/<%= campaign.id %>/edit" class="btn btn-sm btn-secondary"><i class="fas fa-edit"></i> Edit</a>
          <form action="/social/campaigns/<%= campaign.id %>/duplicate" method="POST" style="display: inline;">
            <button type="submit" class="btn btn-sm btn-secondary"><i class="fas fa-copy"></i></button>
          </form>
          <form action="/social/campaigns/<%= campaign.id %>/delete" method="POST" style="display: inline;">
            <button type="submit" class="btn btn-sm btn-danger" data-confirm-delete="Delete this campaign? Posts will be unlinked."><i class="fas fa-trash"></i></button>
          </form>
        </div>
      </div>
      <% }); %>
    </div>
    <% } else { %>
    <div class="card">
      <div class="card-body">
        <div class="empty-state">
          <div class="empty-state-icon"><i class="fas fa-bullhorn"></i></div>
          <h3>No Campaigns Yet</h3>
          <p>Create campaigns to organize your social media posts into strategic groups.</p>
          <a href="/social/campaigns/new" class="btn btn-primary"><i class="fas fa-plus"></i> Create Campaign</a>
        </div>
      </div>
    </div>
    <% } %>
  </div>
</main>

<%- include('../../partials/footer') %>
