<%- include('../../partials/head', { title, bodyClass: 'dashboard-layout' }) %>
<%- include('../../partials/sidebar', { currentPage, user }) %>

<main class="main-content">
  <%- include('../../partials/header', { user, messages }) %>

  <div class="page-content">
    <div class="page-header">
      <div>
        <h1 class="page-title"><%= hashtagSet ? 'Edit Hashtag Set' : 'New Hashtag Set' %></h1>
        <p class="page-subtitle"><a href="/social/hashtags"><i class="fas fa-arrow-left"></i> Back to Hashtag Manager</a></p>
      </div>
    </div>

    <div class="card form-card" style="max-width: 800px;">
      <div class="card-body">
        <form action="<%= hashtagSet ? '/social/hashtags/' + hashtagSet.id : '/social/hashtags' %>" method="POST">

          <div class="form-group">
            <label class="form-label" for="name">Set Name *</label>
            <input type="text" id="name" name="name" class="form-input" required
              value="<%= hashtagSet ? hashtagSet.name : '' %>" placeholder="e.g. SEO Marketing, Laos Travel">
          </div>

          <div class="form-group">
            <label class="form-label" for="description">Description</label>
            <input type="text" id="description" name="description" class="form-input"
              value="<%= hashtagSet ? hashtagSet.description || '' : '' %>" placeholder="When to use this set">
          </div>

          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="category">Category</label>
              <input type="text" id="category" name="category" class="form-input"
                value="<%= hashtagSet ? hashtagSet.category || '' : '' %>" placeholder="e.g. branding, niche, trending">
            </div>
            <div class="form-group">
              <label class="form-label">Target Platforms</label>
              <div style="display: flex; flex-wrap: wrap; gap: 12px; margin-top: 8px;">
                <% platforms.forEach(p => { %>
                <div class="form-checkbox">
                  <input type="checkbox" id="plat_<%= p.id.replace(/[^a-zA-Z]/g, '') %>" name="platforms" value="<%= p.id %>"
                    <%= hashtagSet && hashtagSet.platforms && hashtagSet.platforms.includes(p.id) ? 'checked' : '' %>>
                  <label for="plat_<%= p.id.replace(/[^a-zA-Z]/g, '') %>"><i class="<%= p.icon %>" style="color: <%= p.color %>;"></i> <%= p.id %></label>
                </div>
                <% }); %>
              </div>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="hashtags">
              Hashtags *
              <span id="tagCount" style="float: right; font-weight: 400; color: var(--gray-500); font-size: 12px;">0 tags</span>
            </label>
            <textarea id="hashtags" name="hashtags" class="form-input" rows="4" required
              placeholder="Enter hashtags separated by commas. The # symbol is added automatically.&#10;e.g. marketing, seo, digitalmarketing, socialmedia"><%= hashtagSet && hashtagSet.hashtags ? hashtagSet.hashtags.map(h => h.replace(/^#/, '')).join(', ') : '' %></textarea>
            <p class="form-help">Separate hashtags with commas. # is added automatically.</p>
          </div>

          <!-- Preview -->
          <div class="form-group">
            <label class="form-label">Preview</label>
            <div id="hashtagPreview" class="hashtag-chips" style="min-height: 40px; padding: 12px; background: var(--gray-50); border-radius: var(--radius); border: 1px solid var(--gray-200);"></div>
          </div>

          <div class="form-actions">
            <a href="/social/hashtags" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> <%= hashtagSet ? 'Update' : 'Create' %> Hashtag Set</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const textarea = document.getElementById('hashtags');
  const preview = document.getElementById('hashtagPreview');
  const count = document.getElementById('tagCount');

  function updatePreview() {
    const tags = textarea.value.split(',').map(t => t.trim().replace(/^#/, '')).filter(Boolean);
    count.textContent = tags.length + ' tag' + (tags.length !== 1 ? 's' : '');
    preview.innerHTML = '';
    tags.forEach(t => {
      const chip = document.createElement('span');
      chip.className = 'hashtag-chip';
      chip.textContent = '#' + t;
      preview.appendChild(chip);
    });
  }

  textarea.addEventListener('input', updatePreview);
  updatePreview();
});
</script>

<%- include('../../partials/footer') %>
