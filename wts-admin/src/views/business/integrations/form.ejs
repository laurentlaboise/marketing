<%- include('../../partials/head', { title, bodyClass: 'dashboard-layout' }) %>
<%- include('../../partials/sidebar', { currentPage, user }) %>

<main class="main-content">
  <%- include('../../partials/header', { user, messages }) %>

  <div class="page-content">
    <div class="page-header">
      <div>
        <h1 class="page-title"><%= integration ? 'Edit Integration' : 'New Integration' %></h1>
        <p class="page-subtitle"><a href="/business/integrations"><i class="fas fa-arrow-left"></i> Back to Integrations</a></p>
      </div>
    </div>

    <div class="card form-card">
      <div class="card-body">
        <form action="<%= integration ? '/business/integrations/' + integration.id : '/business/integrations' %>" method="POST">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="platform_name">Platform Name *</label>
              <select id="platform_name" name="platform_name" class="form-input" required>
                <option value="">Select platform...</option>
                <option value="n8n" <%= integration && integration.platform_name === 'n8n' ? 'selected' : '' %>>n8n</option>
                <option value="Make.com" <%= integration && integration.platform_name === 'Make.com' ? 'selected' : '' %>>Make.com</option>
                <option value="Slack" <%= integration && integration.platform_name === 'Slack' ? 'selected' : '' %>>Slack</option>
                <option value="OpenAI" <%= integration && integration.platform_name === 'OpenAI' ? 'selected' : '' %>>OpenAI</option>
                <option value="Anthropic" <%= integration && integration.platform_name === 'Anthropic' ? 'selected' : '' %>>Anthropic</option>
                <option value="Google" <%= integration && integration.platform_name === 'Google' ? 'selected' : '' %>>Google</option>
                <option value="GitHub" <%= integration && integration.platform_name === 'GitHub' ? 'selected' : '' %>>GitHub</option>
                <option value="Stripe" <%= integration && integration.platform_name === 'Stripe' ? 'selected' : '' %>>Stripe</option>
                <option value="Custom API" <%= integration && integration.platform_name === 'Custom API' ? 'selected' : '' %>>Custom API</option>
              </select>
            </div>
            <div class="form-group">
              <label class="form-label" for="workspace_id">Workspace ID *</label>
              <input type="text" id="workspace_id" name="workspace_id" class="form-input" placeholder="UUID of the workspace" value="<%= integration ? integration.workspace_id : '' %>" required>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="api_endpoint">API Endpoint</label>
            <input type="url" id="api_endpoint" name="api_endpoint" class="form-input" placeholder="https://api.example.com/v1" value="<%= integration ? integration.api_endpoint : '' %>">
          </div>

          <div class="form-group">
            <label class="form-label" for="auth_credential_id">Auth Credential ID *</label>
            <input type="text" id="auth_credential_id" name="auth_credential_id" class="form-input" placeholder="UUID referencing stored credential" value="<%= integration ? integration.auth_credential_id : '' %>" required>
            <small style="color: var(--gray-400); font-size: 12px; margin-top: 4px; display: block;">Reference to the credential stored in your secrets manager.</small>
          </div>

          <div class="form-group">
            <label class="form-label" for="rate_limits">Rate Limits (JSON)</label>
            <textarea id="rate_limits" name="rate_limits" class="form-input" rows="3" placeholder='{"requests_per_minute": 60, "burst": 100}'><%= integration && integration.rate_limits ? (typeof integration.rate_limits === 'object' ? JSON.stringify(integration.rate_limits, null, 2) : integration.rate_limits) : '' %></textarea>
            <small style="color: var(--gray-400); font-size: 12px; margin-top: 4px; display: block;">Optional JSON object defining rate limiting rules.</small>
          </div>

          <div class="form-actions">
            <a href="/business/integrations" class="btn btn-secondary">Cancel</a>
            <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Save</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</main>

<%- include('../../partials/footer') %>
